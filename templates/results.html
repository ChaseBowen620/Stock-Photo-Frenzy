{% extends "base.html" %}

{% block title %}Results - Stock Photo Frenzy{% endblock %}

{% block content %}
<div class="container">
    <header>
        <h1>Game Complete!</h1>
        <p>You played {{ total_rounds }} rounds</p>
    </header>
    
    <main>
        <div class="results-container">
            {% if is_multiplayer %}
            {% if game_mode == 'cooperative' %}
            <div class="score-section">
                <h2>Team Final Score</h2>
                <div class="final-score-display">
                    <span class="score-value">{{ shared_score }}</span>
                    <span class="score-label">points</span>
                </div>
                <p class="cooperative-message">Great teamwork everyone! üéâ</p>
            </div>
            {% else %}
            <div class="leaderboard-section">
                <h2>Final Leaderboard</h2>
                <div class="leaderboard-items">
                    {% for participant in leaderboard %}
                    <div class="leaderboard-item {% if loop.index == 1 %}winner{% endif %}">
                        <span class="rank">#{{ loop.index }}</span>
                        <span class="name">
                            {{ participant.player_name }}
                            {% if participant.player_color %}
                            <span style="color: {{ participant.player_color }}; font-weight: bold;">‚óè</span>
                            {% endif %}
                            {% if participant.team %}
                            <span class="team-badge team-{{ participant.team }}">{{ participant.team }}</span>
                            {% endif %}
                        </span>
                        <span class="score">{{ participant.score }} pts</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            {% else %}
            <div class="score-section">
                <h2>Your Final Score</h2>
                <div class="final-score-display">
                    <span class="score-value">{{ final_score }}</span>
                    <span class="score-label">points</span>
                </div>
            </div>
            {% endif %}
            
            {% if is_multiplayer %}
            <div class="join-new-game-section">
                <h3>Join a New Game</h3>
                <input type="text" id="new-lobby-code" placeholder="Enter lobby code..." maxlength="10" style="padding: 12px; border: 2px solid #667eea; border-radius: 8px; font-size: 1.1rem; text-align: center; text-transform: uppercase; margin-bottom: 15px; width: 100%; max-width: 300px;">
                <button onclick="joinNewLobby()" class="btn-primary" style="width: 100%; max-width: 300px;">Join Game</button>
            </div>
            {% else %}
            <div class="results-actions">
                <a href="{{ url_for('index') }}" class="btn-primary">Play Again</a>
            </div>
            {% endif %}
            
            <script>
            function joinNewLobby() {
                const lobbyCode = document.getElementById('new-lobby-code').value.trim().toUpperCase();
                if (lobbyCode) {
                    window.location.href = `/join/${lobbyCode}`;
                } else {
                    alert('Please enter a lobby code');
                }
            }
            
            // Auto-redirect to join page for multiplayer (mobile players only, not host)
            {% if is_multiplayer %}
            // Check if this is a mobile device
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || window.innerWidth < 768;
            if (isMobile) {
                setTimeout(() => {
                    window.location.href = '/join';
                }, 3000);
            }
            {% endif %}
            </script>
        </div>
    </main>
</div>
{% endblock %}

